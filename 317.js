(()=>{"use strict";var e,t,r={d:(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},n={};r.d(n,{UX:()=>_,HE:()=>q,ZA:()=>a,PV:()=>Ie,mh:()=>Ee,p2:()=>Ve,yq:()=>ke,ZP:()=>Ne,Qc:()=>Ce});class a{constructor(e,t){this.layerFrame=e,this.parent=t,this.type="Group",this.children=[]}get name(){return this.layerFrame.layerProperties.name}get opacity(){return this.layerFrame.layerProperties.opacity}get composedOpacity(){return this.parent.composedOpacity*(this.opacity/255)}addChild(e){this.children.push(e)}hasChildren(){return 0!==this.children.length}freeze(){this.children.forEach((e=>e.freeze&&e.freeze())),Object.freeze(this.children)}}!function(e){e.SectionDividerSetting="lsct",e.TypeToolObjectSetting="TySh",e.UnicodeLayerName="luni"}(e||(e={})),function(e){e[e.Normal=0]="Normal",e[e.SceneGroup=1]="SceneGroup"}(t||(t={}));const i=(e,t)=>{const r=Math.max(e.length,t.length);for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0};class s extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=new.target.name}}class o extends s{}class c extends s{}class d extends s{}class l extends s{}class u extends s{}class h extends s{}class p extends s{}class g extends s{}class f extends s{}class y extends s{}class w extends s{}class m extends s{}class S extends s{}class b extends s{}class v extends s{}class x extends s{}class I extends s{}class L extends s{}class k extends s{}class D extends s{}class T extends s{}class U extends s{}class M extends s{}class R extends s{}class P extends s{}class C extends s{}class F extends s{}class O extends s{}class G extends s{}class A extends s{}class B extends s{}class E extends s{}class V extends s{}class z extends s{}class $ extends s{}class N extends s{}function j(e,t){const r=e.getUint32(t),n=e.getUint32(t+4);if(r>=2097152)throw new C;return 4294967296*r+n}const H={u8:1,i8:1,u16:2,i16:2,u32:4,i32:4,u64:8,i64:8,f64:8};class X{constructor(e,t=0){this.dataView=e,this.position=t}get length(){return this.dataView.byteLength}clone(e){const t=void 0!==e?e:this.position;return new X(new DataView(this.dataView.buffer,this.dataView.byteOffset,this.dataView.byteLength),t)}pass(e){this.position+=e}extract(e){if(this.position+e>this.dataView.byteLength)throw new D;return new Uint8Array(this.dataView.buffer,this.dataView.byteOffset+this.position,e)}take(e){const t=this.extract(e);return this.pass(e),t}read(e){const{dataView:t,position:r}=this;switch(this.pass(H[e]),e){case"u8":return t.getUint8(r);case"u16":return t.getUint16(r);case"u32":return t.getUint32(r);case"u64":return j(t,r);case"i8":return t.getInt8(r);case"i16":return t.getInt16(r);case"i32":return t.getInt32(r);case"i64":return function(e,t){const r=e.getInt32(t),n=e.getUint32(t+4);if(r>=2097152||r<-2097152||-2097152===r&&0===n)throw new C;return 4294967296*r+n}(t,r);case"f64":return t.getFloat64(r);default:throw new TypeError(`Invalid ReadType: ${e}`)}}readString(e){const t=this.take(e);return(new TextDecoder).decode(t)}readUnicodeString(e=4){const t=2*this.read("u32"),r=this.take(t),n=new TextDecoder("utf-16be").decode(r);return this.padding(4+t,e),0===n.charCodeAt(n.length-1)?n.slice(0,-1):n}readIdString(){const e=this.read("u32");return this.readString(e||4)}padding(e,t){const r=e%t;r>0&&this.pass(t-r)}}const Z=(e,t,r)=>t<=e&&e<=r;var Y,W,_,q,Q,J,K;function ee(e){const t=Object.keys(Y);for(const r of t)if(Y[r]===e)return e;throw new y}function te(e,t,r){const n=e.items.get(t);if(!n)throw new V(`Cannot find key "${t}" in descriptor`);if(n.type!==r)throw new z(`Unexpected descriptor value type: expected "${r}" but got "${n.type}"`);return n}!function(e){e.PassThrough="pass",e.Normal="norm",e.Dissolve="diss",e.Darken="dark",e.Multiply="mul ",e.ColorBurn="idiv",e.LinearBurn="lbrn",e.DarkerColor="dkCl",e.Lighten="lite",e.Screen="scrn",e.ColorDodge="div ",e.LinearDodge="lddg",e.LighterColor="lgCl",e.Overlay="over",e.SoftLight="sLit",e.HardLight="hLit",e.VividLight="vLit",e.LinearLight="lLit",e.PinLight="pLit",e.HardMix="hMix",e.Difference="diff",e.Exclusion="smud",e.Subtract="fsub",e.Divide="fdiv",e.Hue="hue ",e.Saturation="sat ",e.Color="colr",e.Luminosity="lum "}(Y||(Y={})),function(e){e[e.Base=0]="Base",e[e.NonBase=1]="NonBase"}(W||(W={})),function(e){e[e.Bitmap=0]="Bitmap",e[e.Grayscale=1]="Grayscale",e[e.Indexed=2]="Indexed",e[e.Rgb=3]="Rgb",e[e.Cmyk=4]="Cmyk",e[e.Multichannel=7]="Multichannel",e[e.Duotone=8]="Duotone",e[e.Lab=9]="Lab"}(_||(_={})),function(e){e[e.One=1]="One",e[e.Eight=8]="Eight",e[e.Sixteen=16]="Sixteen",e[e.ThirtyTwo=32]="ThirtyTwo"}(q||(q={})),function(e){e.Alias="alis",e.Boolean="bool",e.Class="type",e.Descriptor="Objc",e.Double="doub",e.Enumerated="enum",e.GlobalClass="GlbC",e.GlobalObject="GlbO",e.Integer="long",e.LargeInteger="comp",e.List="VlLs",e.RawData="tdta",e.Reference="obj ",e.String="TEXT",e.UnitFloat="UntF"}(Q||(Q={})),function(e){e.Angle="#Ang",e.Density="#Rsl",e.Distance="#Rlt",e.Millimeters="#Mlm",e.None="#Nne",e.Percent="#Prc",e.Pixels="#Pxl",e.Points="#Pnt"}(J||(J={})),function(e){e[e.PSD=1]="PSD",e[e.PSB=2]="PSB"}(K||(K={}));const re=[56,66,80,83],ne=[0,0,0,0,0,0],ae=[1,8,16,32];function ie(e,t,r,n,a){const i=new X(e),s=i.read("u16");if(!(s in be))throw new w;const{red:o,green:c,blue:d,alpha:l}=(()=>{switch(s){case be.RawData:return function(e,t,r){const n=(e.length-2)/r,a=e.extract(n),i=r>=2?e.extract(n):void 0,s=r>=3?e.extract(n):void 0,o=r>=4?e.extract(n):void 0;if(t===q.Eight)return{red:a,green:i,blue:s,alpha:o};throw new S(`Unsupported image bit depth: ${t}`)}(i,t,n);case be.RleCompressed:return function(e,t,r,n){let a=0,i=0,s=0,o=0;const c=n.rleScanlineLengthFieldReadType;for(let t=0;t<r;t++)a+=e.read(c);if(t>=2)for(let t=0;t<r;t++)i+=e.read(c);if(t>=3)for(let t=0;t<r;t++)s+=e.read(c);if(4===t)for(let t=0;t<r;t++)o+=e.read(c);const d=2+t*r*n.rleScanlineLengthFieldSize,l=e.clone(d);return{red:l.take(a),green:i?l.take(i):void 0,blue:s?l.take(s):void 0,alpha:o?l.take(o):void 0}}(i,n,r,a);default:throw new m}})();return{compression:s,red:o,green:c,blue:d,alpha:l}}const se=[56,66,73,77];function oe(e){const t=e.take(4);if(!i(t,se))throw new k;const r=e.read("i16"),n=function(e,t=0){const r=e.read("u8"),n=e.readString(r);if(t){const n=(r+1)%t;n>0&&e.pass(t-n)}return n}(e,2),a=e.read("u32"),s=e.position+a,o=a+a%2,c=e.position;let d=null;switch(r){case Le.GridAndGuides:d=function(e){const t=e.read("u32");if(1!==t)throw new T;const r=e.read("u32"),n=e.read("u32"),a=e.read("u32"),i=[];for(let t=0;t<a;++t){const t=e.read("i32"),r=Me(e.read("u8"));i.push({position:t,direction:r})}return{version:t,gridSizeX:r,gridSizeY:n,guides:i}}(e);break;case Le.Slices:d=function(e,t){const r=e.read("u32");if(6===r){const n=e.read("i32"),a=e.read("i32"),i=e.read("i32"),s=e.read("i32"),o=e.readUnicodeString(0),c=e.read("u32"),d=[];for(;d.length<c;){const t=e.read("u32"),r=e.read("u32"),n=Re(e.read("u32")),a=1===n?e.read("u32"):void 0;d.push({id:t,groupId:r,origin:n,associatedLayerId:a,name:e.readUnicodeString(0),type:e.read("u32"),left:e.read("i32"),top:e.read("i32"),right:e.read("i32"),bottom:e.read("i32"),url:e.readUnicodeString(0),target:e.readUnicodeString(0),message:e.readUnicodeString(0),altTag:e.readUnicodeString(0),isCellTextHtml:Boolean(e.read("u8")),cellText:e.readUnicodeString(0),horizontalAlignment:e.read("i32"),verticalAlignment:e.read("i32"),alpha:e.read("u8"),red:e.read("u8"),green:e.read("u8"),blue:e.read("u8")})}return{version:r,boundTop:n,boundLeft:a,boundBottom:i,boundRight:s,sliceGroupName:o,slices:d,descriptor:e.position<t?Oe(e):void 0}}if(7===r||8===r)return{version:r,descriptor:Oe(e)};throw new M(`Invalid Slices section version: ${r}`)}(e,s)}const l=c+o-e.position;return l>0&&e.pass(l),{id:r,name:n,resource:d}}const ce=(e,t,r)=>{const{top:n,left:a,bottom:i,right:s,opacity:o,clipping:c,visible:d,blendMode:l,layerText:u}=t;return{name:e,top:n,left:a,bottom:i,right:s,opacity:o,clippingMask:c,visible:d,blendMode:l,groupId:r,text:u}};class de{constructor(e,t){this.channels=e,this.layerProperties=t}static create(e,t,r){const n=ce(e.name,e,r);return new de(t,n)}get red(){const e=this.channels.get(ve.Red);if(void 0===e)throw new v;return e}get green(){return this.channels.get(ve.Green)}get blue(){return this.channels.get(ve.Blue)}get alpha(){return this.channels.get(ve.TransparencyMask)}get width(){const{right:e,left:t}=this.layerProperties;return e-t+1}get height(){const{bottom:e,top:t}=this.layerProperties;return e-t+1}}class le{constructor(e,t){this.id=e,this.layerProperties=t}static create(e,t,r,n){const a=ce(e,r,n);return new le(t,a)}}function ue(e,r){const n=function(e){if(e in xe)return e;throw new f}(e.read("u32"));if(r<12)return{dividerType:n};const a=e.readString(4);if("8BIM"!==a)throw new O(`Invalid Section Divider Setting signature: ${a}`);const i=ee(e.readString(4));if(r<16)return{dividerType:n,dividerSignature:a,blendMode:i};const s=e.read("u32");if(!(s in t))throw new O(`Invalid Section Divider Setting subtype: ${s}`);return{dividerType:n,dividerSignature:a,blendMode:i,subType:s}}function he(e){const t=e.read("u16");if(1!==t)throw new G(`Invalid type tool object setting version: ${t}`);const r=e.read("f64"),n=e.read("f64"),a=e.read("f64"),i=e.read("f64"),s=e.read("f64"),o=e.read("f64"),c=e.read("u16");if(50!==c)throw new G(`Invalid text version: ${c}`);const d=Oe(e),l=e.read("u16");if(1!==l)throw new G(`Invalid warp version: ${l}`);return{version:t,transformXX:r,transformXY:n,transformYX:a,transformYY:i,transformTX:s,transformTY:o,textVersion:c,textData:d,warpVersion:l,warpData:Oe(e),left:e.read("f64"),top:e.read("f64"),right:e.read("f64"),bottom:e.read("f64")}}function pe(e){return{name:e.readUnicodeString(0)}}function ge(t,r){const n=t.readString(4);if("8BIM"!==n&&"8B64"!==n)throw new F(`Invalid signature: ${n}`);const a=t.readString(4),i=t.read(function(e,t){if(t.aliLengthFieldSizeIsVariable)switch(e){case"LMsk":case"Lr16":case"Lr32":case"Layr":case"Mt16":case"Mt32":case"Mtrn":case"Alph":case"FMsk":case"Ink2":case"FEid":case"FXid":case"PxSD":return"u64"}return"u32"}(a,r)),s=t.position,o=function(t,r,n,a){switch(n){case e.SectionDividerSetting:return{signature:r,key:n,...ue(t,a)};case e.TypeToolObjectSetting:return{signature:r,key:n,...he(t)};case e.UnicodeLayerName:return{signature:r,key:n,...pe(t)};default:return{signature:r,key:n,_isUnknown:!0,data:t.take(a)}}}(t,n,a,i),c=i-(t.position-s);return t.pass(c),t.padding(i,4),o}function fe(t,r){const[n,a,i,s]=function(e){const t=e.read("i32"),r=e.read("i32");let n=e.read("i32");0!==n&&(n-=1);let a=e.read("i32");return 0!==a&&(a-=1),[t,r,n,a]}(t),o=t.read("u16"),c=[];for(;c.length<o;){const e=t.read("i16"),n=t.read(r.layerRecordSectionChannelLengthFieldReadType)-2;c.push([e,n])}if("8BIM"!==t.readString(4))throw new g;const d=ee(t.readString(4)),l=t.read("u8"),u=function(e){if(e===W.Base)return W.Base;if(e===W.NonBase)return W.NonBase;throw new x}(t.read("u8")),h=function(e){return"0"===e.read("u8").toString(2).padStart(8,"0")[7]}(t);t.pass(1);const p=t.read("u32"),f=t.position;t.pass(t.read("u32")),t.pass(t.read("u32"));const y=t.read("u8");let w=t.readString(y);t.padding(y+1,4);const m=[];for(;t.position-f<p;)m.push(ge(t,r));let S,b;for(const t of m)if(!t._isUnknown)switch(t.key){case e.SectionDividerSetting:({dividerType:S}=t);break;case e.TypeToolObjectSetting:{const e=t.textData.descriptor.items.get("Txt ");e&&e.type===Q.String&&(b=e.value);break}case e.UnicodeLayerName:({name:w}=t)}return{name:w,channelInformation:c,top:n,left:a,bottom:i,right:s,visible:h,opacity:l,clipping:u,blendMode:d,additionalLayerInfos:m,dividerType:S,layerText:b}}function ye(e,t,r=4){const n=(4===r?e.getUint32(t):j(e,t))+r;return{start:t,end:t+n,size:n}}const we={maxPixels:3e4,rleScanlineLengthFieldSize:2,rleScanlineLengthFieldReadType:"u16",layerAndMaskSectionLengthFieldSize:4,layerInfoSectionLengthFieldSize:4,layerRecordSectionChannelLengthFieldReadType:"u32",aliLengthFieldSizeIsVariable:!1},me={maxPixels:3e5,rleScanlineLengthFieldSize:4,rleScanlineLengthFieldReadType:"u32",layerAndMaskSectionLengthFieldSize:8,layerInfoSectionLengthFieldSize:8,layerRecordSectionChannelLengthFieldReadType:"u64",aliLengthFieldSizeIsVariable:!0};function Se(e){switch(e){case K.PSD:return we;case K.PSB:return me;default:throw new c}}var be,ve,xe,Ie,Le,ke,De;function Te(e){if(!(e in be))throw new w;return e}function Ue(e){switch(e){case ve.Red:return 0;case ve.Green:return 1;case ve.Blue:return 2;case ve.TransparencyMask:return 3;default:throw new b}}function Me(e){if(!(e in Ie))throw new U;return e}function Re(e){if(!(e in ke))throw new R(`Invalid slice origin: ${e}`);return e}function Pe(e,t,r,n,a){try{t.set(n.data)}catch(e){throw e instanceof RangeError?new Error(`Channel data (${n.data.byteLength} bytes) is too large for the input region (${t.byteLength} bytes)`):e}let i;switch(n.compression){case be.RawData:i=e.decodeUncompressedChannel(t.byteOffset,n.data.byteLength,r,a);break;case be.RleCompressed:i=e.decodeRleChannel(t.byteOffset,n.data.byteLength,r,a);break;default:throw new m(`Unsupported compression method: ${n.compression}`)}if(0!==i)throw new Error(`Decode failed (cause: ${i})`)}function Ce(e){const t=function(e){const t=new DataView(e),r=function(e){const t=new X(e),r=t.take(4);if(!i(r,re))throw new o;const n=t.read("u16");if(n!==K.PSD&&n!==K.PSB)throw new c;const a=Se(n),s=t.take(6);if(!i(s,ne))throw new d;const g=t.read("u16");if(!Z(g,1,56))throw new h;const f=t.read("u32"),y=t.read("u32");if(!Z(f,1,a.maxPixels)||!Z(y,1,a.maxPixels))throw new p;const w=t.read("u16");if(!ae.includes(w))throw new u;const m=t.read("u16");if(m in _==0)throw new l;return{channelCount:g,version:n,width:y,height:f,depth:w,colorMode:m}}(new DataView(e,0,26)),n=Se(r.version),a=ye(t,26),s=ye(t,a.end),g=ye(t,s.end,n.layerAndMaskSectionLengthFieldSize);return{fileHeader:r,colorModeData:new DataView(e,a.size),imageResources:new DataView(e,s.start,s.size),layerAndMaskInformation:new DataView(e,g.start,g.size),imageData:new DataView(e,g.end)}}(e),{fileHeader:r}=t,n=Se(r.version),a=function(e){const t=new X(e),r=[],n=t.read("u32");for(;t.position<n;){const e=oe(t);r.push(e)}return{resources:r}}(t.imageResources),s=function(e,t){const r=new X(e);r.pass(t.layerAndMaskSectionLengthFieldSize),r.pass(t.layerInfoSectionLengthFieldSize);const n=r.read("i16"),a=Math.abs(n),i=function(e,t,r){const n=[];for(;n.length<t;)n.push(fe(e,r));const a=n.map((t=>{const n=function(e){return e.bottom-e.top+1}(t),a=function(e,t,r,n){const a=new Map,{length:i}=t;for(let s=0;s<i;s++){const[i,o]=t[s],c=Te(e.read("u16")),d=e.take(o);switch(c){case be.RawData:a.set(i,{compression:c,data:d});break;case be.RleCompressed:{const e=r*n.rleScanlineLengthFieldSize,t=new Uint8Array(d.buffer,d.byteOffset+e,d.byteLength-e);a.set(i,{compression:c,data:t});break}}}return a}(e,t.channelInformation,n,r);return[t,a]})).reverse();return a}(r,a,t),s=[],o=[],c=[],d=[{startIndex:0,groupId:0,parentGroupId:0}];let l=0;for(let e=0;e<a;e++){const[t,r]=i[e],n=d[d.length-1].groupId,{dividerType:a}=t;if(a===xe.CloseFolder||a===xe.OpenFolder)l+=1,d.push({startIndex:s.length,groupId:l,parentGroupId:n,layerRecord:t}),c.push("G");else if(a===xe.BoundingSection){const e=d.pop();if(void 0===e)throw new I;const r=e.groupId>0?e.groupId:void 0,n=e.layerRecord||t;o.push(le.create(n.name,e.groupId,n,r)),c.push("D")}else s.push(de.create(t,r,n)),c.push("L")}return o.sort(((e,t)=>e.id-t.id)),{layers:s,groups:o,orders:c}}(t.layerAndMaskInformation,n);return{fileHeader:r,colorModeData:void 0,imageResources:a,layerAndMaskInfo:s,imageData:ie(t.imageData,r.depth,r.height,r.channelCount,n)}}function Fe(e){const t=e.readUnicodeString(0),r=e.readIdString(),n=e.read("u32"),a=new Map;for(;a.size<n;){const t=e.readIdString(),r=Ge(e);if(a.has(t))throw new E(`Duplicate descriptor key: ${t}`);a.set(t,r)}return{name:t,classId:r,items:a}}function Oe(e){const t=e.read("u32");if(16!==t)throw new B(`Invalid descriptor version: ${t}`);return{descriptorVersion:t,descriptor:Fe(e)}}function Ge(e){const t=e.readString(4);switch(t){case Q.Alias:{const r=e.read("u32");return{type:t,data:e.take(r)}}case Q.Boolean:return{type:t,value:Boolean(e.read("u8"))};case Q.Class:case Q.GlobalClass:return{type:t,name:e.readUnicodeString(0),classId:e.readIdString()};case Q.Descriptor:case Q.GlobalObject:return{type:t,descriptor:Fe(e)};case Q.Double:return{type:t,value:e.read("f64")};case Q.Enumerated:return{type:t,enumType:e.readIdString(),enumValue:e.readIdString()};case Q.Integer:return{type:t,value:e.read("i32")};case Q.LargeInteger:return{type:t,value:e.read("i64")};case Q.List:{const r=e.read("u32"),n=[];for(;n.length<r;)n.push(Ge(e));return{type:t,values:n}}case Q.RawData:{const r=e.read("u32");return{type:t,data:e.take(r)}}case Q.Reference:{const r=e.read("u32"),n=[];for(;n.length<r;)n.push(Ae(e));return{type:t,references:n}}case Q.String:return{type:t,value:e.readUnicodeString(0)};case Q.UnitFloat:return{type:t,unitType:function(e){if(!Object.values(J).includes(e))throw new N(`Invalid Unit Float type: ${e}`);return e}(e.readString(4)),value:e.read("f64")};default:throw new A(`Unexpected descriptor type: ${t}`)}}function Ae(e){const t=e.readString(4);switch(t){case De.Class:return{type:t,name:e.readUnicodeString(0),classId:e.readIdString()};case De.Enumerated:return{type:t,name:e.readUnicodeString(0),classId:e.readIdString(),typeId:e.readIdString(),enumValue:e.readIdString()};case De.Identifier:return{type:t,identifier:e.readString(4)};case De.Index:return{type:t,index:e.read("u32")};case De.Name:return{type:t,name:e.readUnicodeString(0)};case De.Offset:return{type:t,name:e.readUnicodeString(0),classId:e.readIdString(),offset:e.read("u32")};case De.Property:return{type:t,name:e.readUnicodeString(0),classId:e.readIdString(),keyId:e.readIdString()};default:throw new $(`Invalid reference type: ${t}`)}}!function(e){e[e.RawData=0]="RawData",e[e.RleCompressed=1]="RleCompressed",e[e.ZipWithoutPrediction=2]="ZipWithoutPrediction",e[e.ZipWithPrediction=3]="ZipWithPrediction"}(be||(be={})),function(e){e[e.Red=0]="Red",e[e.Green=1]="Green",e[e.Blue=2]="Blue",e[e.TransparencyMask=-1]="TransparencyMask",e[e.UserSuppliedLayerMask=-2]="UserSuppliedLayerMask",e[e.RealUserSuppliedLayerMask=-3]="RealUserSuppliedLayerMask"}(ve||(ve={})),function(e){e[e.Other=0]="Other",e[e.OpenFolder=1]="OpenFolder",e[e.CloseFolder=2]="CloseFolder",e[e.BoundingSection=3]="BoundingSection"}(xe||(xe={})),function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"}(Ie||(Ie={})),function(e){e[e.GridAndGuides=1032]="GridAndGuides",e[e.Slices=1050]="Slices"}(Le||(Le={})),function(e){e[e.AutoGenerated=0]="AutoGenerated",e[e.LayerGenerated=1]="LayerGenerated",e[e.UserGenerated=2]="UserGenerated"}(ke||(ke={})),function(e){e.Class="Clss",e.Enumerated="Enmr",e.Identifier="Idnt",e.Index="indx",e.Name="name",e.Offset="rele",e.Property="prop"}(De||(De={}));class Be{composite(e=!0,t=!0){const{red:r,green:n,blue:a,alpha:i}=this.imageData,{width:s,height:o}=this,c=function(e,t,r,n,a,i){var s,o,c,d;const l=e*t;if(!(l>0&&Number.isInteger(l)))throw new Error(`Pixel count must be a positive integer, got ${l}`);const u=4*l,h=Math.max(null!==(s=r.data.byteLength)&&void 0!==s?s:0,null!==(o=null==a?void 0:a.data.byteLength)&&void 0!==o?o:0,null!==(c=null==n?void 0:n.data.byteLength)&&void 0!==c?c:0,null!==(d=null==i?void 0:i.data.byteLength)&&void 0!==d?d:0);if(!(h>=0&&Number.isInteger(h)))throw new Error(`Input region size must be a nonnegative integer, got ${h}`);const p=new ArrayBuffer(function(e){let t=65536;for(;t<e;)t<16777216?t<<=1:t+=16777216;return t}(u+h)),g=new Uint8ClampedArray(p,0,u),f=new Uint8Array(p,u),y=function(e,t,r){"use asm";const n=new e.Int8Array(r),a=new e.Uint8Array(r);function i(e,t,r,a){e=e|0;t=t|0;r=r|0;a=a|0;var i=0;var s=0;var o=0;i=e;s=a+r|0;for(o=i+t|0;(i|0)<(o|0);i=i+1|0){n[s]=n[i];s=s+4|0}return 0}function s(e,t,r,a){e=e|0;t=t|0;r=r|0;a=a|0;var i=0;var s=0;var o=0;var c=0;var d=0;var l=0;var u=0;i=e;s=a+r|0;while((i|0)<(e+t|0)){o=n[i]|0;i=i+1|0;if((o|0)==-128){continue}else if((o|0)>=0){for(d=i+o+1|0;(i|0)<(d|0);i=i+1|0){n[s]=n[i];s=s+4|0}}else{l=n[i]|0;i=i+1|0;u=1-o|0;for(c=0;(c|0)<(u|0);c=c+1|0){n[s]=l;s=s+4|0}}}return 0}function o(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0;var s=0;i=r+e|0;s=e+t|0;while((i|0)<(s|0)){a[i]=n|0;i=i+4|0}return 0}return{decodeUncompressedChannel:i,decodeRleChannel:s,setChannelValue:o}}({Int8Array,Uint8Array},0,p);return Pe(y,f,g.byteOffset,r,Ue(ve.Red)),Pe(y,f,g.byteOffset,null!=n?n:r,Ue(ve.Green)),Pe(y,f,g.byteOffset,null!=a?a:r,Ue(ve.Blue)),i?Pe(y,f,g.byteOffset,i,Ue(ve.TransparencyMask)):function(e,t,r,n,a){if(!Number.isInteger(255))throw new Error("Channel value must be an integer between 0 and 255, got 255");const i=e.setChannelValue(t,r,a,255);if(0!==i)throw new Error(`Channel update failed (cause: ${i})`)}(y,g.byteOffset,g.byteLength,0,Ue(ve.TransparencyMask)),g.slice()}(s,o,r,n,a,i);return!0===e?function(e,t=255){if(!(0<=t&&t<=255))throw new L;const r=e.length/4,n=Ue(ve.TransparencyMask),a=t/255;for(let t=0;t<r;t++){const r=4*t+n;e[r]=Math.floor(a*e[r])}return e}(c,!0===t?255*this.composedOpacity:this.opacity):c}}class Ee extends Be{constructor(e,t){super(),this.layerFrame=e,this.parent=t,this.type="Layer"}get name(){return this.layerFrame.layerProperties.name}get width(){return this.layerFrame.width}get height(){return this.layerFrame.height}get top(){return this.layerFrame.layerProperties.top}get left(){return this.layerFrame.layerProperties.left}get opacity(){return this.layerFrame.layerProperties.opacity}get composedOpacity(){return this.parent.composedOpacity*(this.opacity/255)}get text(){return this.layerFrame.layerProperties.text}get imageData(){const{red:e,green:t,blue:r,alpha:n}=this.layerFrame;return{red:e,green:t,blue:r,alpha:n}}}class Ve{constructor(e,t,r,n,a){this.origin=e,this.left=t,this.top=r,this.right=n,this.bottom=a}}function ze(e){if(e.resource.descriptor){const t=e.resource.descriptor.descriptor.items.get("slices");if(!t||t.type!==Q.List)throw new P('Missing key "slices" in slice descriptor');return t.values.reduce(((e,t)=>{if(t.type!==Q.Descriptor)throw new P(`Slice list contains a non-descriptor (type: ${t.type})`);return e.push(function(e){const t=function(e){const t=te(e,"origin",Q.Enumerated);if("ESliceOrigin"!==t.enumType)throw new P(`Unexpected enum type for slice origin: got "${t.enumType}"`);switch(t.enumValue){case"layerGenerated":return ke.LayerGenerated;case"userGenerated":return ke.UserGenerated;case"autoGenerated":return ke.AutoGenerated;default:throw new P(`Unexpected enum value for slice origin: got "${t.enumValue}"`)}}(e),r=te(e,"bounds",Q.Descriptor).descriptor,n=te(r,"Top ",Q.Integer).value,a=te(r,"Left",Q.Integer).value,i=te(r,"Btom",Q.Integer).value,s=te(r,"Rght",Q.Integer).value;return new Ve(t,a,n,s,i)}(t.descriptor)),e}),[])}throw new P("No slice descriptor in slice resource block")}class $e extends Be{constructor(e){super(),this.parsingResult=e,this.name="ROOT",this.type="Psd",this.opacity=255,this.composedOpacity=1,this.children=[],this.layers=[],this.guides=[],this.slices=[],this.buildTreeStructure();for(const t of e.imageResources.resources)if(null!==t.resource)switch(t.id){case Le.GridAndGuides:this.guides=t.resource.guides;break;case Le.Slices:this.slices=ze(t)}}static parse(e){const t=Ce(e);return new $e(t)}get width(){return this.parsingResult.fileHeader.width}get height(){return this.parsingResult.fileHeader.height}get channelCount(){return this.parsingResult.fileHeader.channelCount}get depth(){return this.parsingResult.fileHeader.depth}get colorMode(){return this.parsingResult.fileHeader.colorMode}get imageData(){const{compression:e,red:t,green:r,blue:n,alpha:a}=this.parsingResult.imageData;return{red:{compression:e,data:t},green:r?{compression:e,data:r}:void 0,blue:n?{compression:e,data:n}:void 0,alpha:a?{compression:e,data:a}:void 0}}buildTreeStructure(){const{groups:e,layers:t,orders:r}=this.parsingResult.layerAndMaskInfo,n=[this];let i=0,s=0;r.forEach((r=>{var o,c;const d=n[n.length-1];switch(r){case"G":{const t=e[i],r=new a(t,d);n.push(r),null===(o=d.children)||void 0===o||o.push(r),i+=1;break}case"L":{const e=t[s],r=new Ee(e,d);this.layers.push(r),null===(c=d.children)||void 0===c||c.push(r),s+=1;break}case"D":n.pop()}})),n.length=0,this.children.forEach((e=>e.freeze&&e.freeze())),Object.freeze(this.children)}}const Ne=$e;var je=n.ZP;const He="this-is-a-message";self.addEventListener("message",(({data:e})=>{const{type:t,timestamp:r,value:n}=e;if(function(e){if("object"!=typeof e||null===e||!("type"in e)||!("value"in e)||e.signature!==He)throw new TypeError(`data is not an ExampleMessage (got ${e})`);const t=e.type;switch(t){case"Layer":case"MainImageData":case"ParseData":return;default:(e=>{throw new TypeError(`Unexpected ExampleMessage type: ${e}`)})(t)}}(e),console.log("It took %d ms to send this message (main → worker, type: %o)",Date.now()-r,t),"ParseData"===t){console.time("Parse PSD file");const e=je.parse(n);console.timeEnd("Parse PSD file"),console.log(e),e.layers.forEach(((e,t)=>{console.time(`Compositing layer ${t}`);const r=e.composite(!0,!0);console.timeEnd(`Compositing layer ${t}`),self.postMessage(function(e,t){return{type:"Layer",value:t,signature:He,timestamp:Date.now()}}(0,{pixelData:r,name:e.name,left:e.left,top:e.top,width:e.width,height:e.height}),[r.buffer])}))}else console.error("Worker received a message that it cannot handle: %o",e)}))})();